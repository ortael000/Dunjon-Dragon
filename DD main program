
function createopponent (Vname,VPV,VCA,VInit,VAtt1,Vproba1,Vdegmin1,Vdegmax1,Vtoucher1,Veffet1,VAtt2,Vproba2,Vdegmin2,Vdegmax2,Vtoucher2,Veffet2,VAtt3,Vproba3,Vdegmin3,Vdegmax3,Vtoucher3,Veffet3,Vbutin1,Vnombre1,VProbabut1,Vbutin2,Vnombre2,VProbabut2,VXP) {
    let monster = {

        name: Vname,
        PV: VPV,
        CA: VCA,
        init: VInit,
        att1: VAtt1,  
        proba1: Vproba1,
        degmin1: Vdegmin1,
        degmax1: Vdegmax1,
        toucher1: Vtoucher1,
        effet1: Veffet1,
        att2: VAtt2,
        proba2: Vproba2,
        degmin2: Vdegmin2,
        degmax2: Vdegmax2,
        toucher2: Vtoucher2,
        effet2: Veffet2,
        att3: VAtt3,
        proba3: Vproba3,
        degmin3: Vdegmin3,
        degmax3: Vdegmax3,
        toucher3: Vtoucher3,
        effet3: Veffet3,
        butin1: Vbutin1,
        nombre1: Vnombre1,
        probabut1: VProbabut1,
        butin2: Vbutin2,
        nombre2: Vnombre2,
        probabut2: VProbabut2,
        XP: VXP,
        };

        return monster;
        
} 


function dice(min,max) { // fonction qui simule un nombre entier aléatoire entre le min et le max
    let random = (Math.random())*(max-min)+min-1;
    return Math.ceil(random);
}


function attaque_de(ennemie) { // Renvoie un texte avec les valeurs d'attaque du monstre "indice" du tableau des monstres ennemies
        
    const testatt = Math.random();

    if (testatt <ennemie.proba1) {
        let attaq = ennemie.att1;
        let deg = dice(ennemie.degmin1,ennemie.degmax1);
        let touche = dice(1,20)+ennemie.toucher1;
        let effect = ennemie.effet1;
        console.log(ennemie.name + " attaque avec " + attaq + " et inflige " + deg + " avec une touche de " + touche + " . Les effets supplémentaires sont :" + effect);

    }else if (testatt <ennemie.proba1 + ennemie.proba2 ) {
        let attaq = ennemie.att2;
        let deg = dice(ennemie.degmin2,ennemie.degmax2);
        let touche = dice(1,20)+ennemie.toucher2;
        let effect = ennemie.effet2;
        console.log(ennemie.name + " attaque avec " + attaq + " et inflige " + deg + " avec une touche de " + touche + " . Les effets supplémentaires sont :" + effect);

    }else{
        let attaq = ennemie.att3;
        let deg = dice(ennemie.degmin3,ennemie.degmax3);
        let touche = dice(1,20)+ennemie.toucher3;
        let effect = ennemie.effet3;
        console.log(ennemie.name + " attaque avec " + attaq + " et inflige " + deg + " avec une touche de " + touche + " . Les effets supplémentaires sont :" + effect);
    }

    // console.log(ennemie.name + " attaque avec " + attaq + " et inflige" + deg + " avec une touche de " + touche + " les effets supplémentaires sont :" + effect);
    // poser la question de pourquoi ça ne marche pas comme ça (on obtient un retour comme les variables dans le if ne sont jamais lues)
}
function calculatebutin (tableau) { // pour une liste de monstre donnée (un tableau), calcule de manière aléatoire le butin (en fonction des propriétés de butin des monstres)
    let i = 1;
    let XPtotal = 0;

    for (let deadmonster of tableau){
        let nombrebutin1 = dice(0,deadmonster.nombre1);
        if (nombrebutin1 > 0) {
        console.log("Vous récupérez " +nombrebutin1+ " "+ deadmonster.butin1+" sur le cadavre de " + deadmonster.name);
        }
        let nombrebutin2 = dice(0,deadmonster.nombre2);
        if (nombrebutin2 > 0) {
        console.log("Vous récupérez " +nombrebutin2+ " "+ deadmonster.butin2+" sur le cadavre de " + deadmonster.name);
        }
        XPtotal += deadmonster.XP;
       
    }
    console.log("Votre groupe gagne de l'XP pour un total de ", XPtotal);

}

function calculateinitiative (tableau) { // Rentre en input un tableau de monstre et renvoie en output un tableau de monstre ranger par ordre d'initiative (généré aléatoirement)
    let resultv = 0;
    let resultinit = [];
    let resultinitfinal = [];
    let tableauenordre = [];
    let i = 0;
    let initmax = 0;

    console.log("on calcule l'initiative sur " + tableau.length + " monstre" );

    for (let i = 0; i < tableau.length ; i++) {

        let resultv = dice(1,20)+tableau[i].init;
        resultinit.push(resultv);

        //console.log(tableau[i].name + " resultat "+ resultinit[i]) ;  //  TEST POUR VOIR QUE LA PREMIERE PARTIE FONCTIONNE

        if (initmax<=resultinit[i]) {
            initmax = resultinit[i];
            //console.log(" init max est maintenant "+ initmax); //test pour voir que la VAR INITMAX est bien mise à jour
            } 
    }


    for (let j = 1; j <= initmax; j++){

        for (let k = 0; k < tableau.length; k++){
            

            if (resultinit[k]==j) {
                tableauenordre.unshift(tableau[k]);
                resultinitfinal.unshift(resultinit[k]);
            }
        }
    }

    for (let k = 0; k < tableau.length; k++){
        console.log(tableauenordre[k].name + " attaque en " + (k+1) + " avec un jet d'initiative de " + resultinitfinal[k]);

    }
return tableauenordre;
}

const readline = require("readline");

const rl = readline.createInterface({
    input: process.stdin,
    output:process.stdout
})

//console.log("Combien d'ennemie sont face à vous?")

//const numberofenn = prompt()

//if(isNaN(numberofenn)){
   //console.log("Ceci n'est pas un nombre");
//}


let monsterlist = [];

let soldatgoth = createopponent ("Soldat Gothir",18,14,1,"Coup d'épée",0.8,4,9,3,"none","Charge",0.2,5,10,0,"Si réussi, fais perdre 2 de toucher à la cible au tour suivant"," 0 ",0,0,0,0," ","pièce de cuivre",50,0.3,"none",0,0,250);
let archergoth = createopponent ("Archer Gothir",14,14,3,"Tir à l'arc",1,3,8,3,"Si au CAC, deviens un coup d'épée, ajouter 1 dégat et retirer 2 toucher","none",0,0,0,0," "," 0 ",0,0,0,0," ","pièce de cuivre",50,0.3,"none",0,0,300);
let chevaliergoth = createopponent ("Chevalier Gothir",22,18,5,"Coup d'épée",0.7,5,13,6,"none","Charge montée",0.3,7,17,3," Si echoué, attaque d'opportunité de l'adversaire "," 0 ",0,0,0,0," ","pièce d'argent",4,0.3,"potion de soin mineur",1,0,530);


monsterlist.push(soldatgoth);
monsterlist.push(archergoth);
monsterlist.push(archergoth);
monsterlist.push(soldatgoth);
monsterlist.push(chevaliergoth);

let monsterlistorder = calculateinitiative(monsterlist);

let test = "test";

//while(test = "test"){                            //ne fonctionne pas en l'état
    /*rl.question("A qui le tour d'attaquer? ",(answer)=> {

        if (!isNaN(answer)){
            attaque_de(monsterlistorder[answer-1]);
        }else if (answer == "butin") {
            calculatebutin (tableau);
            test = "end";
            rl.close();
        }else {
            console.log("réponse non valide");
        }
        

    })

//} */

rl.setPrompt("A qui le tour d'attaquer? ");
rl.prompt();
rl.on('line',(answer)=>{
    if (!isNaN(answer)){
        attaque_de(monsterlistorder[answer-1]);
        rl.setPrompt("A qui le tour d'attaquer? ");
        rl.prompt();
    }else if (answer == "butin") {
        calculatebutin (monsterlistorder);
        test = "end";
        rl.close();
    }else {
        console.log("réponse non valide");
        rl.setPrompt("A qui le tour d'attaquer? ");
        rl.prompt();
}
})

//calculatebutin(monsterlist);
